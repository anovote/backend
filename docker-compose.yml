version: '3.9'
services:
    # app:
    #     container_name: 'anovote_backend'
    #     image: anovote:backend
    #     build: .
    #     ports:
    #         - '${HTTP_PORT}:${HTTP_PORT}'
    #     volumes:
    #         - './logs:/app/logs'
    #     networks:
    #         - anovote_backend
    #     depends_on:
    #         - 'db'
    #     env_file:
    #         - '.env'
    # db:
    #     container_name: 'anovote_database'
    #     image: postgres
    #     volumes:
    #         - anovote-data:/var/lib/postgresql
    #     networks:
    #         - anovote_backend
    #     environment:
    #         TZ: 'Europe/Oslo'
    nginx:
        image: nginx:1.15-alpine
        ports:
            - '80:80'
            - '443:443'
        volumes:
            #    - ./tempBuild/frontend/build:/www/
            - ./data/nginx:/etc/nginx/conf.d
            - ./data/certbot/conf:/etc/letsencrypt
            - ./data/certbot/www:/var/www/certbot
        # networks:
        #     - anovote_backend
        command: '/bin/sh -c ''while :; do sleep 6h & wait $${!}; nginx -s reload; done & nginx -g "daemon off;"'''
    certbot:
        image: certbot/certbot
        volumes:
            - ./data/certbot/conf:/etc/letsencrypt
            - ./data/certbot/www:/var/www/certbot
        # networks:
        #     - anovote_backend
        entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
volumes:
    anovote-data:
networks:
    anovote_backend:
